InVzZSBjbGllbnQiOwppbXBvcnQgeyBTdXNwZW5zZSwgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gInJlYWN0IjsKaW1wb3J0IHsgbW90aW9uLCBBbmltYXRlUHJlc2VuY2UgfSBmcm9tICJmcmFtZXItbW90aW9uIjsKaW1wb3J0IHsgRXllLCBFeWVPZmYsIEFycm93TGVmdCB9IGZyb20gImx1Y2lkZS1yZWFjdCI7CmltcG9ydCB7IHVzZUF1dGggfSBmcm9tICJAL2NvbXBvbmVudHMvYXV0aC9BdXRoUHJvdmlkZXIiOwppbXBvcnQgeyB1c2VSb3V0ZXIsIHVzZVNlYXJjaFBhcmFtcyB9IGZyb20gIm5leHQvbmF2aWdhdGlvbiI7CmltcG9ydCBMaW5rIGZyb20gIm5leHQvbGluayI7CgovLyBJbm5lciBjb21wb25lbnQgdGhhdCB1c2VzIHVzZVNlYXJjaFBhcmFtcyAtIG11c3QgYmUgd3JhcHBlZCBpbiBTdXNwZW5zZQpmdW5jdGlvbiBBdXRoRm9ybSgpIHsKICBjb25zdCBbbW9kZSwgc2V0TW9kZV0gPSB1c2VTdGF0ZTwic2lnbmluIiB8ICJzaWdudXAiPigic2lnbmluIik7CiAgY29uc3QgW2VtYWlsLCBzZXRFbWFpbF0gPSB1c2VTdGF0ZSgiIik7CiAgY29uc3QgW3Bhc3N3b3JkLCBzZXRQYXNzd29yZF0gPSB1c2VTdGF0ZSgiIik7CiAgY29uc3QgW25hbWUsIHNldE5hbWVdID0gdXNlU3RhdGUoIiIpOwogIGNvbnN0IFtmYWN1bHR5LCBzZXRGYWN1bHR5XSA9IHVzZVN0YXRlKCJGTVBDIik7CiAgY29uc3QgW3Nob3dQdywgc2V0U2hvd1B3XSA9IHVzZVN0YXRlKGZhbHNlKTsKICBjb25zdCBbbG9hZGluZywgc2V0TG9hZGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7CiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZSgiIik7CiAgY29uc3QgW3BlbmRpbmdSZWRpcmVjdCwgc2V0UGVuZGluZ1JlZGlyZWN0XSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpOwogIGNvbnN0IHsgc2lnbkluLCBzaWduVXAsIHVzZXIgfSA9IHVzZUF1dGgoKTsKICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKTsKICBjb25zdCBzZWFyY2hQYXJhbXMgPSB1c2VTZWFyY2hQYXJhbXMoKTsKCiAgY29uc3QgRkFDVUxUWV9TRU06IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7CiAgICBGTVBDOiAiczEiLCBGTVBSOiAiUzFfRk1QUiIsIEZNUE06ICJTMV9GTVBNIiwgVU02U1M6ICJTMV9VTTYiLCBGTVBERjogInMxX0ZNUERGIiwKICB9OwoKICAvLyBPbmNlIEF1dGhQcm92aWRlciBwcm9wYWdhdGVzIHRoZSB1c2VyIHN0YXRlLCBkbyB0aGUgcmVkaXJlY3QKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKHVzZXIgJiYgcGVuZGluZ1JlZGlyZWN0KSB7CiAgICAgIHJvdXRlci5yZXBsYWNlKHBlbmRpbmdSZWRpcmVjdCk7CiAgICAgIHNldFBlbmRpbmdSZWRpcmVjdChudWxsKTsKICAgIH0KICB9LCBbdXNlciwgcGVuZGluZ1JlZGlyZWN0LCByb3V0ZXJdKTsKCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlKGU6IFJlYWN0LkZvcm1FdmVudCkgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgc2V0RXJyb3IoIiIpOwogICAgc2V0TG9hZGluZyh0cnVlKTsKICAgIC8vIEhvbm91ciB0aGUgP25leHQ9IHBhcmFtIHNldCBieSBtaWRkbGV3YXJlLCBmYWxsIGJhY2sgdG8gL3NlbWVzdHJlcy9zMQogICAgY29uc3QgbmV4dFBhdGggPSBzZWFyY2hQYXJhbXMuZ2V0KCJuZXh0IikgfHwgbnVsbDsKICAgIGlmIChtb2RlID09PSAic2lnbmluIikgewogICAgICBjb25zdCB7IGVycm9yOiBlcnIgfSA9IGF3YWl0IHNpZ25Jbihlb WFpbCwgcGFzc3dvcmQpOwogICAgICBpZiAoZXJyKSB7IHNldEVycm9yKGVycik7IHNldExvYWRpbmcoZmFsc2UpOyB9CiAgICAgIGVsc2Ugc2V0UGVuZGluZ1JlZGlyZWN0KG5leHRQYXRoID8/ICIvc2VtZXN0cmVzL3MxIik7CiAgICB9IGVsc2UgewogICAgICBpZiAoIW5hbWUudHJpbSgpKSB7IHNldEVycm9yKCJFbnRyZXogbGUgcHJlbm9tIik7IHNldExvYWRpbmcoZmFsc2UpOyByZXR1cm47IH0KICAgICAgY29uc3QgeyBlcnJvcjogZXJyIH0gPSBhd2FpdCBzaWduVXAoZW1haWwsIHBhc3N3b3JkLCBuYW1lLCBmYWN1bHR5KTsKICAgICAgaWYgKGVycikgeyBzZXRFcnJvcihlcnIpOyBzZXRMb2FkaW5nKGZhbHNlKTsgfQogICAgICBlbHNlIHNldFBlbmRpbmdSZWRpcmVjdChuZXh0UGF0aCA/PyBgL3NlbWVzdHJlcy8ke0ZBQ1VMVFlfU0VNW2ZhY3VsdHldID8/ICJzMSJ9YCk7CiAgICB9CiAgfQoKICBjb25zdCBpbnB1dENscyA9ICJ3LWZ1bGwgcHgtNCBweS0zIHJvdW5kZWQteGwgdGV4dC1zbSBib3JkZXIgZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOnJpbmctMSBmb2N1czpyaW5nLWJsdWUtNTAwLzQwIHRyYW5zaXRpb24tY29sb3JzIjsKICBjb25zdCBpbnB1dFN0eWxlID0geyBiYWNrZ3JvdW5kOiAidmFyKC0tYmcpIiwgYm9yZGVyQ29sb3I6ICJ2YXIoLS1ib3JkZXIpIiwgY29sb3I6ICJ2YXIoLS10ZXh0KSIgfTsKCiAgcmV0dXJuICgKICAgIDxtb3Rpb24uZGl2IGluaXRpYWw9e3sgb3BhY2l0eTogMCwgeTogMTYgfX0gYW5pbWF0ZT17eyBvcGFjaXR5OiAxLCB5OiAwIH19IGNsYXNzTmFtZT0idy1mdWxsIG1heC13LXNtIHNwYWNlLXktNiI+CiAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciBzcGFjZS15LTIiPgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LTEyIGgtMTIgcm91bmRlZC0yeGwgYmctYmx1ZS01MDAvMTAgYm9yZGVyIGJvcmRlci1ibHVlLTUwMC8yMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBteC1hdXRvIj4KICAgICAgICAgIDxzdmcgdmlld0JveD0iMCAwIDQwIDQwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzTmFtZT0idy04IGgtOCI+CiAgICAgICAgICAgIDxyZWN0IHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcng9IjEwIiBmaWxsPSJ2YXIoLS10ZXh0KSIgLz4KICAgICAgICAgICAgPHRleHQgeD0iNTAlIiB5PSI1NSUiIGRvbWluYW50QmFzZWxpbmU9Im1pZGRsZSIgdGV4dEFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ2YXIoLS1iZykiIGZvbnRTaXplPSIxOCIgZm9udFdlaWdodD0iNzAwIiBmb250RmFtaWx5PSJzeXN0ZW0tdWksLWFwcGxlLXN5c3RlbSxzYW5zLXNlcmlmIj5aPC90ZXh0PgogICAgICAgICAgPC9zdmc+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGgxIGNsYXNzTmFtZT0idGV4dC14bCBmb250LWJvbGQiIHN0eWxlPXt7IGNvbG9yOiAidmFyKC0tdGV4dCkiIH19PgogICAgICAgICAge21vZGUgPT09ICJzaWduaW4iID8gIkNvbm5leGlvbiIgOiAiQ3JlZXIgdW4gY29tcHRlIn0KICAgICAgICA8L2gxPgogICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zbSIgc3R5bGU9e3sgY29sb3I6ICJ2YXIoLS10ZXh0LW11dGVkKSIgfX0+WmVyb1FDTSDigJQgTWVkZWNpbmUgTWFyb2M8L3A+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzc05hbWU9InJvdW5kZWQtMnhsIGJvcmRlciBwLTYgc3BhY2UteS00IiBzdHlsZT17eyBiYWNrZ3JvdW5kOiAidmFyKC0tc3VyZmFjZSkiLCBib3JkZXJDb2xvcjogInZhcigtLWJvcmRlcikiIH19PgogICAgICAgIDxmb3JtIG9uU3VibWl0PXtoYW5kbGV9IGNsYXNzTmFtZT0ic3BhY2UteS0zIj4KICAgICAgICAgIDxBbmltYXRlUHJlc2VuY2U+CiAgICAgICAgICAgIHttb2RlID09PSAic2lnbnVwIiAmJiAoCiAgICAgICAgICAgICAgPG1vdGlvbi5kaXYga2V5PSJzaWdudXAtZmllbGRzIiBpbml0aWFsPXt7IG9wYWNpdHk6IDAsIGhlaWdodDogMCB9fSBhbmltYXRlPXt7IG9wYWNpdHk6IDEsIGhlaWdodDogImF1dG8iIH19IGV4aXQ9e3sgb3BhY2l0eTogMCwgaGVpZ2h0OiAwIH19IGNsYXNzTmFtZT0ic3BhY2UteS0zIG92ZXJmbG93LWhpZGRlbiI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IlZvdHJlIHByZW5vbSIgdmFsdWU9e25hbWV9IG9uQ2hhbmdlPXsoZSkgPT4gc2V0TmFtZShlLnRhcmdldC52YWx1ZSl9IGNsYXNzTmFtZT17aW5wdXRDbHN9IHN0eWxlPXtpbnB1dFN0eWxlfSByZXF1aXJlZCAvPgogICAgICAgICAgICAgICAgPHNlbGVjdCB2YWx1ZT17ZmFjdWx0eX0gb25DaGFuZ2U9eygpID0+IHNldEZhY3VsdHkoZS50YXJnZXQudmFsdWUpfSBjbGFzc05hbWU9e2lucHV0Q2xzfSBzdHlsZT17aW5wdXRTdHlsZX0+CiAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkZNUEMiPkZNUEMg4oCUIENhc2FibGFuY2E8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRk1QUiI+Rk1QUiDih oCUIFJhYmF0PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkZNUE0iPkZNUE0g4oCUIE1hcnJha2VjaDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJVTTZTUyI+VU02U1Mg4oCUIFVNNjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJGTVBERiI+Rk1QREYg4oCUIEZlczwvb3B0aW9uPgogICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgPC9tb3Rpb24uZGl2PgogICAgICAgICAgICApfQogICAgICAgICAgPC9BbmltYXRlUHJlc2VuY2U+CgogICAgICAgICAgPGlucHV0IHR5cGU9ImVtYWlsIiBwbGFjZWhvbGRlcj0iQWRyZXNzZSBlbWFpbCIgdmFsdWU9e2VtYWlsfSBvbkNoYW5nZT17KGUpID0+IHNldEVtYWlsKGUudGFyZ2V0LnZhbHVlKX0gY2xhc3NOYW1lPXtpbnB1dENsc30gc3R5bGU9e2lucHV0U3R5bGV9IHJlcXVpcmVkIC8+CgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9InJlbGF0aXZlIj4KICAgICAgICAgICAgPGlucHV0IHR5cGU9e3Nob3dQdyA/ICJ0ZXh0IiA6ICJwYXNzd29yZCJ9IHBsYWNlaG9sZGVyPSJNb3QgZGUgcGFzc2UiIHZhbHVlPXtwYXNzd29yZH0gb25DaGFuZ2U9eyhlKSA9PiBzZXRQYXNzd29yZChlLnRhcmdldC52YWx1ZSl9IGNsYXNzTmFtZT17aW5wdXRDbHMgKyAiIHByLTExIn0gc3R5bGU9e2lucHV0U3R5bGV9IHJlcXVpcmVkIG1pbkxlbmd0aD17Nn0gLz4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uQ2xpY2s9eygpID0+IHNldFNob3dQdygEc2hvd1B3KX0gY2xhc3NOYW1lPSJhYnNvbHV0ZSByaWdodC0zIHRvcC0xLzIgLXRyYW5zbGF0ZS15LTEvMiIgc3R5bGU9e3sgY29sb3I6ICJ2YXIoLS10ZXh0LW11dGVkKSIgfX0+CiAgICAgICAgICAgICAge3Nob3dQdyA/IDxFeWVPZmYgY2xhc3NOYW1lPSJ3LTQgaC00IiAvPiA6IDxFeWUgY2xhc3NOYW1lPSJ3LTQgaC00IiAvPn0KICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICB7ZXJyb3IgJiYgPHAgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtcmVkLTQwMCBiZy1yZWQtNTAwLzEwIGJvcmRlciBib3JkZXItcmVkLTUwMC8yMCByb3VuZGVkLXhsIHB4LTMgcHktMiI+e2Vycm9yfTwvcD59CgogICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGRpc2FibGVkPXtsb2FkaW5nfQogICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBweS0zLjUgcm91bmRlZC0yeGwgdGV4dC1zbSBmb250LXNlbWlib2xkIGJnLXdoaXRlIHRleHQtYmxhY2sgaG92ZXI6YmctemluYy0xMDAgZGlzYWJsZWQ6b3BhY2l0eS01MCB0cmFuc2l0aW9uLWFsbCI+CiAgICAgICAgICAgIHtsb2FkaW5nID8gIi4uLiIgOiBtb2RlID09PSAic2lnbmluIiA/ICJTZSBjb25uZWN0ZXIiIDogIkNyZWVyIG1vbiBjb21wdGUifQogICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9mb3JtPgoKICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtY2VudGVyIHRleHQteHMiIHN0eWxlPXt7IGNvbG9yOiAidmFyKC0tdGV4dC1tdXRlZCkiIH19PgogICAgICAgICAge21vZGUgPT09ICJzaWduaW4iID8gIlBhcyBlbmNvcmUgZGUgY29tcHRlID8iIDogIkRlamEgaW5zY3JpdCA/In17IiAifQogICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiB7IHNldE1vZGUobW9kZSA9PT0gInNpZ25pbiIgPyAic2lnbnVwIiA6ICJzaWduaW4iKTsgc2V0RXJyb3IoIiIpOyB9fQogICAgICAgICAgICBjbGFzc05hbWU9InRleHQtYmx1ZS00MDAgaG92ZXI6dW5kZXJsaW5lIGZvbnQtbWVkaXVtIj4KICAgICAgICAgICAge21vZGUgPT09ICJzaWduaW4iID8gIkNyZWVyIHVuIGNvbXB0ZSIgOiAiU2UgY29ubmVjdGVyIn0KICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvcD4KICAgICAgPC9kaXY+CiAgICA8L21vdGlvbi5kaXY+CiAgKTsKfQoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQXV0aFBhZ2UoKSB7CiAgcmV0dXJuICgKICAgIDxkaXYgY2xhc3NOYW1lPSJtaW4taC1zY3JlZW4gZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcHgtNCIgc3R5bGU9e3sgYmFja2dyb3VuZDogInZhcigtLWJnKSIgfX0+CiAgICAgIDxMaW5rIGhyZWY9Ii8iIGNsYXNzTmFtZT0iYWJzb2x1dGUgdG9wLTYgbGVmdC02IGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHRleHQtc20gdHJhbnNpdGlvbi1jb2xvcnMiCiAgICAgICAgc3R5bGU9e3sgY29sb3I6ICJ2YXIoLS10ZXh0LW11dGVkKSIgfX0+CiAgICAgICAgPEFycm93TGVmdCBjbGFzc05hbWU9Incf0IBoLTQiIC8+IFJldG91cgogICAgICA8L0xpbms+CiAgICAgIDxTdXNwZW5zZT4KICAgICAgICA8QXV0aEZvcm0gLz4KICAgICAgPC9TdXNwZW5zZT4KICAgIDwvZGl2PgogICk7Cn0K